<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TechShopApp.Views.ProduktPage"
             xmlns:local="clr-namespace:TechShopApp.ViewModels.ProduktVM"
             xmlns:model="clr-namespace:TechShopApp.ServiceReference"
             x:Name="BrowseItemsPage"
             Title="{Binding Title}"
             BackgroundColor="#121212">
    <Grid RowSpacing="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="100" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0" Padding="10" BackgroundColor="#1E1E2F">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="4*" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>
            <Label Grid.Column="0" TextColor="#08D9D6" FontSize="34" HorizontalTextAlignment="Start" VerticalTextAlignment="Center" Margin="0,-10,0,0">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="Tech" FontSize="34" FontAttributes="Bold"/>
                        <Span Text="Shop" TextColor="#FF2E63"/>
                    </FormattedString>
                </Label.FormattedText>
            </Label>
            <SearchBar Grid.Column="1"
                       Placeholder="Szukaj produktu..."
                       PlaceholderColor="#BBB"
                       Text="{Binding SearchText}"
                       BackgroundColor="#2A2A3D"
                       TextColor="White"
                       VerticalOptions="Center"
                       Margin="0,0,10,0" />
            <Button Grid.Column="2"
                    Text="＋"
                    Command="{Binding AddItemCommand}"
                    FontSize="28"
                    TextColor="White"
                    BackgroundColor="#FF2E63"
                    CornerRadius="20"
                    HorizontalOptions="End"
                    VerticalOptions="Center"
                    WidthRequest="50"
                    HeightRequest="50" />
        </Grid>
        <Grid Grid.Row="1" Padding="10">
            <RefreshView Command="{Binding LoadItemsCommand}"
                         IsRefreshing="{Binding IsBusy, Mode=TwoWay}">
                <CollectionView ItemsSource="{Binding Items}"
                                SelectionMode="None">
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical"
                                         Span="2"
                                         HorizontalItemSpacing="15"
                                         VerticalItemSpacing="15"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:ProduktForView">
                            <Frame Padding="10"
                                   CornerRadius="20"
                                   HasShadow="True"
                                   BackgroundColor="#1E1E2F"
                                   HeightRequest="250"
                                   x:DataType="model:ProduktForView">
                                <Grid RowSpacing="5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <StackLayout Grid.Row="0" Spacing="5">
                                        <Frame CornerRadius="15" 
                                               Padding="0" 
                                               IsClippedToBounds="True" 
                                               HasShadow="False" 
                                               BackgroundColor="Transparent" 
                                               HorizontalOptions="Center" 
                                               HeightRequest="100" 
                                               WidthRequest="180">
                                            <Image Source="product_placeholder.png" Aspect="AspectFill" />
                                        </Frame>
                                        <Label Text="{Binding Nazwa}"
                                               FontSize="20"
                                               FontAttributes="Bold"
                                               TextColor="White"
                                               HorizontalOptions="FillAndExpand"
                                               HorizontalTextAlignment="Center"
                                               LineBreakMode="WordWrap"
                                               MaxLines="2" />
                                    </StackLayout>
                                    <StackLayout Grid.Row="1"
                                                 VerticalOptions="EndAndExpand"
                                                 Spacing="2">
                                        <Label Text="{Binding Cena, StringFormat='Cena: {0} zł'}"
                                               FontSize="18"
                                               TextColor="#00C6AE"
                                               HorizontalOptions="Center"
                                               VerticalOptions="End" 
                                               Margin="0, 5"/>

                                        <Label Text="{Binding Opis}"
                                               FontSize="12"
                                               TextColor="#BBBBBB"
                                               LineBreakMode="TailTruncation"
                                               MaxLines="3"
                                               HorizontalOptions="Start"
                                               VerticalOptions="End"
                                               Padding="5,0"/>
                                    </StackLayout>
                                </Grid>
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type local:ProduktViewModel}}, Path=ItemTapped}"
                                                          CommandParameter="{Binding .}" />
                                </Frame.GestureRecognizers>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>
        </Grid>
    </Grid>
</ContentPage>
